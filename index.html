<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Catatan Imunisasi</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f9ff; }
    h1 { text-align: center; color: #004080; }
    .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, button { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #004080; color: white; border: none; cursor: pointer; margin-top: 15px; }
    button:hover { background: #0066cc; }
    .row { display: flex; gap: 10px; }
    .row > div { flex: 1; }
    .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 5px; margin-top: 10px; }
    .result, .rekap { margin-top: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; font-size: 14px; }
    th { background: #e6f0ff; }
    .menu { text-align: center; margin-bottom: 20px; }
    .menu button { width: auto; margin: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìã Catatan Imunisasi</h1>
    
    <div class="menu">
      <button onclick="showForm()">‚ûï Input Data</button>
      <button onclick="showRekap()">üìä Rekap</button>
    </div>

    <!-- Form Input -->
    <div id="formSection">
      <label>NIK Anak</label>
      <input type="text" id="nikAnak" maxlength="16">

      <label>Nama Anak</label>
      <input type="text" id="namaAnak">

      <label>NIK Wali</label>
      <input type="text" id="nikWali" maxlength="16">

      <label>Nama Wali</label>
      <input type="text" id="namaWali">

      <label>No WhatsApp</label>
      <input type="text" id="wa">

      <div class="row">
        <div>
          <label>Kelurahan</label>
          <select id="kelurahan">
            <option value="">--Pilih Kelurahan--</option>
            <option>KarangKlesem</option>
            <option>Teluk</option>
            <option>Berkoh</option>
            <option>PWT Kidul</option>
            <option>PWT Kulon</option>
            <option>Tanjung</option>
            <option>Karangpucung</option>
          </select>
        </div>
        <div>
          <label>RT</label>
          <input type="text" id="rt">
        </div>
        <div>
          <label>RW</label>
          <input type="text" id="rw">
        </div>
      </div>

      <label>Jenis Vaksin</label>
      <div class="checkbox-grid" id="vaksinList"></div>

      <button onclick="simpanData()">üíæ Simpan Data</button>

      <label>Cari NIK / Nama Anak</label>
      <input type="text" id="cariInput" placeholder="Masukkan NIK / Nama">
      <button onclick="cariData()">üîç Cari</button>

      <div class="result" id="hasil"></div>
    </div>

    <!-- Rekap -->
    <div id="rekapSection" style="display:none;">
      <h2>üìä Rekap Data</h2>
      <label>Filter Kelurahan</label>
      <select id="filterKelurahan" onchange="filterRekap()">
        <option value="">Semua</option>
        <option>KarangKlesem</option>
        <option>Teluk</option>
        <option>Berkoh</option>
        <option>PWT Kidul</option>
        <option>PWT Kulon</option>
        <option>Tanjung</option>
        <option>Karangpucung</option>
      </select>

      <label>Rentang Tanggal</label>
      <div class="row">
        <input type="date" id="tglAwal">
        <input type="date" id="tglAkhir">
      </div>
      <button onclick="filterRekap()">üîç Tampilkan</button>
      <button onclick="exportExcel()">‚¨áÔ∏è Export Excel</button>

      <div class="rekap" id="rekap"></div>
    </div>
  </div>

<script>
const vaksinOptions = ["HB0","BCG","Pol1","DPT1","Pol2","DPT2","Pol3","DPT3","Pol4",
"IPV","IPV2","MR","PENTA boster","MR boster","PCV 1","PCV 2","PCV 3","RV 1","RV 2","RV 3"];

let cache = [];

// Generate checkbox vaksin
window.onload = () => {
  const vDiv = document.getElementById("vaksinList");
  vaksinOptions.forEach(v=>{
    let label=document.createElement("label");
    label.innerHTML=`<input type="checkbox" value="${v}"> ${v}`;
    vDiv.appendChild(label);
  });
  loadData(); // load cache awal
};

function showForm(){
  document.getElementById("formSection").style.display="block";
  document.getElementById("rekapSection").style.display="none";
}

function showRekap(){
  document.getElementById("formSection").style.display="none";
  document.getElementById("rekapSection").style.display="block";
  filterRekap();
}

// Simpan data
function simpanData(){
  const data = ambilDataForm();
  if(!data.nikAnak || !data.namaAnak){ alert("Lengkapi data!"); return; }
  
  data.tanggal = new Date().toLocaleString();

  // simpan ke cache
  cache.push([
    data.tanggal,data.nikAnak,data.namaAnak,data.nikWali,data.namaWali,
    data.wa,data.kelurahan,data.rt,data.rw,data.vaksin.join(";")
  ]);

  tampilHasil();
  kosongkanForm();
  alert("‚úÖ Data berhasil disimpan!");
}

// Ambil form
function ambilDataForm(){
  const vSelected = [...document.querySelectorAll("#vaksinList input:checked")].map(i=>i.value);
  return {
    nikAnak: document.getElementById("nikAnak").value.trim(),
    namaAnak: document.getElementById("namaAnak").value.trim(),
    nikWali: document.getElementById("nikWali").value.trim(),
    namaWali: document.getElementById("namaWali").value.trim(),
    wa: document.getElementById("wa").value.trim(),
    kelurahan: document.getElementById("kelurahan").value,
    rt: document.getElementById("rt").value,
    rw: document.getElementById("rw").value,
    vaksin: vSelected
  };
}

// Kosongkan form
function kosongkanForm(){
  document.querySelectorAll("input").forEach(i=>i.value="");
  document.querySelectorAll("#vaksinList input").forEach(i=>i.checked=false);
  document.getElementById("kelurahan").value="";
}

// Cari data
function cariData(){
  let key=document.getElementById("cariInput").value.trim().toLowerCase();
  let found=cache.filter(r=>r[1].toLowerCase().includes(key)||r[2].toLowerCase().includes(key));
  if(found.length===0){ 
    document.getElementById("hasil").innerHTML="<p style='color:red'>‚ùå Data tidak ditemukan, silakan input baru.</p>";
  } else {
    tampilHasil(found);
  }
}

// Tampil hasil
function tampilHasil(data=cache){
  let html="<table><tr><th>Tanggal</th><th>NIK Anak</th><th>Nama Anak</th><th>NIK Wali</th><th>Nama Wali</th><th>WA</th><th>Kelurahan</th><th>RT</th><th>RW</th><th>Vaksin</th></tr>";
  data.forEach(r=>{
    html+=`<tr>${r.map(c=>"<td>"+c+"</td>").join("")}</tr>`;
  });
  html+="</table>";
  document.getElementById("hasil").innerHTML=html;
}

// Rekap
function filterRekap(){
  let fKel=document.getElementById("filterKelurahan").value;
  let tAwal=document.getElementById("tglAwal").value;
  let tAkhir=document.getElementById("tglAkhir").value;

  let filtered=cache.filter(r=>{
    let t=new Date(r[0]);
    let ok=true;
    if(fKel && r[6]!==fKel) ok=false;
    if(tAwal && t < new Date(tAwal)) ok=false;
    if(tAkhir && t > new Date(tAkhir+"T23:59:59")) ok=false;
    return ok;
  });

  tampilRekap(filtered);
}

function tampilRekap(data){
  if(data.length===0){ document.getElementById("rekap").innerHTML="<p>Tidak ada data</p>"; return; }
  let html="<table><tr><th>Kelurahan</th><th>Jumlah</th></tr>";
  let grup={};
  data.forEach(r=>{ grup[r[6]]=(grup[r[6]]||0)+1; });
  for(let k in grup){ html+=`<tr><td>${k}</td><td>${grup[k]}</td></tr>`; }
  html+="</table>";
  document.getElementById("rekap").innerHTML=html;
}

// Export Excel
function exportExcel(){
  if(cache.length===0){ alert("Data kosong!"); return; }
  let csv="Tanggal,NIK Anak,Nama Anak,NIK Wali,Nama Wali,No WA,Kelurahan,RT,RW,Vaksin\n";
  cache.forEach(r=>{ csv+=r.join(",")+"\n"; });
  let blob=new Blob([csv],{type:"text/csv"});
  let url=URL.createObjectURL(blob);
  let a=document.createElement("a");
  a.href=url; a.download="catatan_imunisasi.csv"; a.click();
  URL.revokeObjectURL(url);
}

// Load data (simulasi)
function loadData(){ cache=[]; } 
</script>
</body>
</html>
